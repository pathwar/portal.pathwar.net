doctype html
html(ng-app="portal", lang="en")
  head
    title Pathwar Portal

    base(href="#{BASE_PATH}")

    meta(charset="utf-8")
    meta(name="viewport", content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no")

    //- bower:css
    //- endinject

    //- inject:css
    //- endinject

  body(ng-class="{frontpage: state == 'home'}").bg-lighter-gray

    div.side-menu.bg-black.white.md-show
      div.px2.mt2
        img(src="#{BASE_PATH}assets/img/logo.png", width="32", height="32").rounded
      a.button.button-transparent.block
        span PATHWAR
        
      nav.mt3
        a.button.button-transparent.block(ui-sref="crud.list")
        a.button.button-transparent.block(ui-sref="home.welcome")
          i.fa.fa-tachometer.inline-block.mr1
          span.darken-1 Home
          i.fa.fa-lock
          |&nbsp; CRUD
        a.button.button-transparent.block(ui-sref="levels.list")
          i.fa.fa-desktop
          |&nbsp; Levels
        a.button.button-transparent.block(ui-sref="shop")
          i.fa.fa-shopping-cart
          |&nbsp; Shop
        a.button.button-transparent.block(ui-sref="users.list")
          i.fa.fa-users
          |&nbsp; Users
        a.button.button-transparent.block(ui-sref="news.list")
          i.fa.fa-rss
          |&nbsp; News
        a.button.button-transparent.block(ui-sref="chat.room")
          i.fa.fa-rss
          |&nbsp; Chat
        a.button.button-transparent.block(ui-sref="organizations.list")
          i.fa.fa-building-o
          |&nbsp; Organizations

    nav.bg-lighter-gray.clearfix.fixed.top-0.right-0.left-0.has-side-menu.z1.px3(ng-controller="NavCtrl as nav")

      // Anonymous
      div.sm-col-right(ng-if="!nav.isAuthentificated()")
        a(ui-sref="login").button.button-transparent.py2 Login
        a(ui-sref="register").button.button-transparent.py2 Register

      // Logged in
      div(ng-if="nav.isAuthentificated()")

        div(data-disclosure, style="vertical-align: top").inline-block
          div(data-details).fixed.top-0.right-0.bottom-0.left-0
          div.relative
            a.button.button-narrow.button-transparent.py2
              img(ng-src="{{nav.currentUser.organization.getAvatarUrl(32)}}", width="32", height="32").rounded.avatar-button-left.ml0
              | {{nav.currentUser.organization.name}}
              i.fa.fa-sort-down.icon-button
              // FIXME: add the current session name {{currentUser.organization.session}}
            div(data-details).absolute.left-0.mt1.nowrap.bg-blue.rounded.animation-fadein.z1.ml1
              a(ng-repeat="organization in nav.organizations", ng-click="nav.switchOrganization(organization)").button.block.button-transparent.py2.px1
                img(ng-src="{{organization.getAvatarUrl(32)}}", width="32", height="32").rounded.avatar-button-left.ml0
                | {{organization.name}} {{organization.session}}
              a(ui-sref="createOrganization").button.block.button-transparent.bg-dark.py2.px1.center.rounded-bottom
                | New

        //
        // User Menu
        //
        div(data-disclosure, style="vertical-align: top").inline-block.right
          div(data-details).fixed.top-0.right-0.bottom-0.left-0
          div.relative
            a.button.button-narrow.py2.px1.button-transparent.regular
              img(ng-src="{{nav.currentUser.getAvatarUrl(32)}}", width="32", height="32").rounded.avatar-button
            div(data-details).absolute.right-0.mt1.nowrap.bg-blue.rounded.animation-fadein.z1.mr1
              a(ui-sref="users.view({id: nav.currentUser._id})").button.block.button-transparent.py2.px1
                | Profile
              a(ng-click="nav.logout()").button.block.button-transparent.py2.px1
                | Log out
        
        //
        // Money
        //
        div(data-disclosure).inline-block.right
          div(data-details).fixed.top-0.right-0.bottom-0.left-0
          div.relative
            a.button.button-transparent.py2.px1.relative
              i.fa.fa-usd
              div.rounded.bg-yellow.h6.px1.inline-block {{nav.currentUser.organization.statistics.cash}}
            div(data-details).absolute.right-0.mt1.nowrap.bg-blue.rounded.animation-fadein.z1
              a(ui-sref="coupons.redeem").button.block.button-transparent.py2.px1
                | Redeem a coupon
              
        //
        // Notifications
        //
        div(data-disclosure).inline-block.right
          div(data-details).fixed.top-0.right-0.bottom-0.left-0
          div.relative
            a.button.button-transparent.py2.px1.relative
              i.fa.fa-bell-o
              div.rounded.bg-red.h6.px1.inline-block {{nav.notifications.length}}
            div(data-details, style="min-width: 400px").absolute.right-0.mt1.nowrap.bg-blue.rounded.animation-fadein.z1
              div(notifications)
              

    div.p3.has-side-menu.content
      div(ui-view)

    //- bower:js
    //- endinject

    //- inject:js
    //- endinject

    if env == "production"

      script.
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-47629346-3', 'auto');
